{% extends '../../base.html' %}
{% block content %}
{% load static %}
{% include '../navbar.html' %}
{% include '../sidebar.html' %}

<div class="p-4 sm:ml-64 mt-14 bg-green-50">
    <div class="p-4 rounded-lg dark:border-gray-700">
        <!-- Main content area -->
        <main class="flex-1 overflow-y-auto">
            <div class="max-w-7xl mx-auto">
                <!-- Page Header -->
                <h2 class="text-4xl font-bold dark:text-white mb-2.5">Course Delivery Management</h2>

                <!-- Breadcrumb -->
                <nav class="flex mb-5" aria-label="Breadcrumb">
                    <ol class="inline-flex items-center space-x-1 md:space-x-2 rtl:space-x-reverse">
                        <li class="inline-flex items-center">
                            <a href="{% url 'course_list' %}" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-green-600 dark:text-gray-400 dark:hover:text-white">
                                <svg class="w-3 h-3 me-2.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="m19.707 9.293-2-2-7-7a1 1 0 0 0-1.414 0l-7 7-2 2a1 1 0 0 0 1.414 1.414L2 10.414V18a2 2 0 0 0 2 2h3a1 1 0 0 0 1-1v-4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h3a2 2 0 0 0 2-2v-7.586l.293.293a1 1 0 0 0 1.414-1.414Z"/>
                                </svg>
                                Courses
                            </a>
                        </li> 
                        <li>
                            <div class="flex items-center">
                              <svg class="rtl:rotate-180 w-3 h-3 text-gray-400 mx-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
                              </svg>
                              <a href="{% url 'course_delivery_list' course.id %}" class="ms-1 text-sm font-medium text-gray-700 hover:text-green-600 md:ms-2 dark:text-gray-400 dark:hover:text-white">{{ course }}</a>
                            </div>
                        </li>  
                        <li>
                            <div class="flex items-center">
                              <svg class="rtl:rotate-180 w-3 h-3 text-gray-400 mx-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
                              </svg>
                              <a href="#" class="ms-1 text-sm font-medium text-gray-700 hover:text-green-600 md:ms-2 dark:text-gray-400 dark:hover:text-white">Create Course Delivery</a>
                            </div>
                        </li>   
                    </ol>
                </nav>

                <!-- Multi-step form -->
                <form id="courseDeliveryForm" method="post" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                    {% csrf_token %}
                    <!-- Progress bar -->
                    <div class="mb-8">
                        <div class="flex justify-between mb-1">
                            <span class="text-base font-medium text-green-700 dark:text-white">Progress</span>
                            <span class="text-sm font-medium text-green-700 dark:text-white" id="progress-text">20%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700">
                            <div class="bg-green-600 h-2.5 rounded-full transition-all duration-500 ease-in-out" id="progress-bar" style="width: 20%"></div>
                        </div>
                    </div>

                    <!-- Step 1: Basic Details -->
                    <div class="step" id="step1">
                        <h3 class="text-2xl font-semibold mb-4">Basic Details</h3>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="id_delivery_code">
                                Delivery Code
                            </label>
                            <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="id_delivery_code" name="delivery_code" type="text" placeholder="Enter delivery code" readonly="readonly" value="{{ form.delivery_code.value }}">
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="id_delivery_type">
                                How will the course be delivered?
                            </label>
                            <select class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="id_delivery_type" name="delivery_type">
                                <option value="SELF_PACED" {% if form.delivery_type.value == "SELF_PACED" %}selected{% endif %}>Self Paced</option>
                                <option value="INSTRUCTOR_LED" {% if form.delivery_type.value == "INSTRUCTOR_LED" %}selected{% endif %}>Instructor Led</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="id_enrollment_type">
                                How will the learners enroll in this Course?
                            </label>
                            <select class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="id_enrollment_type" name="enrollment_type">
                                <option value="OPEN" {% if form.enrollment_type.value == "OPEN" %}selected{% endif %}>Open Enrollment</option>
                                <option value="INVITE" {% if form.enrollment_type.value == "INVITE" %}selected{% endif %}>By Invitation</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="id_all_participants_access">
                                Do you want all the Participants to access this Course?
                            </label>
                            <input class="mr-2 leading-tight" type="checkbox" id="id_all_participants_access" name="all_participants_access" {% if form.all_participants_access.value %}checked{% endif %}>
                            <span class="text-sm">Yes, allow all participants to access this course</span>
                        </div>
                    </div>

                    <!-- Step 2: Assign Facilitators -->
                    <div class="step hidden" id="step2">
                        <h3 class="text-2xl font-semibold mb-4">Assign Facilitators</h3>
                        <div class="mb-4">
                            <label for="facilitators" class="block text-sm font-medium text-gray-700">Facilitators</label>
                            <select id="facilitators" name="facilitators" multiple="multiple" class="form-multiselect mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                {% for facilitator in form.facilitators.field.queryset %}
                                    <option value="{{ facilitator.pk }}" {% if facilitator.pk in form.facilitators.value %}selected{% endif %}>{{ facilitator }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <!-- Step 3: Assign Participants -->
                    <div class="step hidden" id="step3">
                        <h3 class="text-2xl font-semibold mb-4">Assign Participants</h3>
                        <div class="mb-4">
                            <label for="participants" class="block text-sm font-medium text-gray-700">Participants</label>
                            <select id="participants" name="participants" multiple="multiple" class="form-multiselect mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                {% for participant in form.participants.field.queryset %}
                                    <option value="{{ participant.pk }}" {% if participant.pk in form.participants.value %}selected{% endif %}>{{ participant }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <!-- Step 4: Advanced Settings -->
                    <div class="step hidden" id="step4">
                        <h3 class="text-2xl font-semibold mb-4">Advanced Settings</h3>

                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="access_period_checkbox">
                                Would you like to add access period for Course content for this Delivery?
                            </label>
                            <input class="mr-2 leading-tight" type="checkbox" id="access_period_checkbox">
                            <span class="text-sm">Yes, add access period</span>
                            
                            <div id="date-range-picker" class="hidden mt-4">
                                <div class="flex items-center">
                                    <div class="relative">
                                        <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                                            <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"/>
                                            </svg>
                                        </div>
                                        <input id="datepicker-range-start" name="start_date" type="date" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full ps-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Select date start" value="{{ form.start_date.value|date:'Y-m-d' }}">
                                    </div>
                                    <span class="mx-4 text-gray-500">to</span>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                                            <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"/>
                                            </svg>
                                        </div>
                                        <input id="datepicker-range-end" name="end_date" type="date" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full ps-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Select date end" value="{{ form.end_date.value|date:'Y-m-d' }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            const checkbox = document.getElementById('access_period_checkbox');
                            const dateRangePicker = document.getElementById('date-range-picker');
                        
                            checkbox.addEventListener('change', function() {
                                if (this.checked) {
                                    dateRangePicker.classList.remove('hidden');
                                } else {
                                    dateRangePicker.classList.add('hidden');
                                }
                            });
                        });
                        </script>
                        

                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="deactivation_date">
                                Would you like to add deactivation date for this Delivery?
                            </label>
                            <input class="mr-2 leading-tight" type="checkbox" id="deactivation_date_checkbox">
                            <span class="text-sm">Yes, add deactivation date</span>
                        
                            <div id="datepicker-container" class="hidden mt-4">
                                <div class="relative max-w-sm">
                                    <div class="absolute inset-y-0 start-0 flex items-center ps-3.5 pointer-events-none">
                                        <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"/>
                                        </svg>
                                    </div>
                                    <input id="default-datepicker" name="deactivation_date" type="date" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full ps-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Select date" value="{{ form.deactivation_date.value|date:'Y-m-d' }}">
                                </div>   
                            </div>
                        </div>
                        
                        <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            const checkbox = document.getElementById('deactivation_date_checkbox');
                            const datepickerContainer = document.getElementById('datepicker-container');
                        
                            checkbox.addEventListener('change', function() {
                                if (this.checked) {
                                    datepickerContainer.classList.remove('hidden');
                                } else {
                                    datepickerContainer.classList.add('hidden');
                                }
                            });
                        });
                        </script>


                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="id_feedback">
                                Would you like to get feedback from the Participant for this Delivery?
                            </label>
                            <input class="mr-2 leading-tight" type="checkbox" id="id_feedback" name="feedback">
                            <span class="text-sm">Yes, collect feedback</span>
                        </div>

                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="id_mandatory">
                                Would you like to mark this Delivery as Mandatory for the Participant?
                            </label>
                            <input class="mr-2 leading-tight" type="checkbox" id="id_mandatory" name="mandatory">
                            <span class="text-sm">Yes, mark as mandatory</span>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="id_attendance">
                                Do you want to capture the Participant attendance for this Course?
                            </label>
                            <input class="mr-2 leading-tight" type="checkbox" id="id_attendance" name="attendance>
                            <span class="text-sm">Yes, capture attendance</span>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="id_completion_certificate">
                                Does this Course require a Completion Certificate?
                            </label>
                            <input class="mr-2 leading-tight" type="checkbox" id="id_completion_certificate" name="completion_certificate">
                            <span class="text-sm">Yes, require completion certificate</span>
                        </div>
                    </div>

                    <!-- Step 5: Email Settings -->
                    <div class="step hidden" id="step5">
                        <h3 class="text-2xl font-semibold mb-4">Email Settings</h3>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="id_invite_email">
                                Invite Email Template
                            </label>
                            <textarea class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="id_invite_email" name="invite_email" rows="4"></textarea>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="id_completion_email">
                                Completion Email Template
                            </label>
                            <textarea class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="id_completion_email" name="completion_email" rows="4"></textarea>
                        </div>
                    </div>

                    <!-- Navigation buttons -->
                    <div class="flex justify-between mt-6">
                        <button type="button" id="prevBtn" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-110">
                            Previous
                        </button>
                        <button type="button" id="nextBtn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-110">
                            Next
                        </button>
                        <button type="submit" id="submitBtn" class="hidden bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-110">
                            Submit
                        </button>
                    </div>
                </form>
            </div>
        </main>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('courseDeliveryForm');
        const steps = document.querySelectorAll('.step');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        let currentStep = 0;

        function showStep(step) {
            steps.forEach((s, index) => {
                if (index === step) {
                    s.classList.remove('hidden');
                    s.classList.add('animate-fade-in');
                } else {
                    s.classList.add('hidden');
                    s.classList.remove('animate-fade-in');
                }
            });

            prevBtn.style.display = step === 0 ? 'none' : 'inline-block';
            nextBtn.style.display = step === steps.length - 1 ? 'none' : 'inline-block';
            submitBtn.style.display = step === steps.length - 1 ? 'inline-block' : 'none';

            const progress = ((step + 1) / steps.length) * 100;
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `${Math.round(progress)}%`;
        }

        function validateStep(step) {
            // Add validation logic for each step
            // Return true if the step is valid, false otherwise
            return true;
        }

        prevBtn.addEventListener('click', function() {
            if (currentStep > 0) {
                currentStep--;
                showStep(currentStep);
            }
        });

        nextBtn.addEventListener('click', function() {
            if (validateStep(currentStep) && currentStep < steps.length - 1) {
                currentStep++;
                showStep(currentStep);
            }
        });

        form.addEventListener('submit', function(e) {
        if (!validateStep(currentStep)) {
            //e.preventDefault();
        } else {
            // Allow form submission
            console.log('Form submitted');
            // Remove this line if you want to allow the form to be submitted normally
            // e.preventDefault();
            // Optionally, add AJAX call here to submit the form data without page refresh
        }
    });

        // Initialize the form
        showStep(currentStep);
    });
</script>

<style>
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    .animate-fade-in {
        animation: fadeIn 0.5s ease-in-out;
    }
</style>

{% endblock %}